<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Deploy Django app with CLI</title>
    <meta name="generator" content="VuePress 1.8.2">
    
    <meta name="description" content="">
    
    <link rel="preload" href="/assets/css/0.styles.17d6210f.css" as="style"><link rel="preload" href="/assets/js/app.a4767bdc.js" as="script"><link rel="preload" href="/assets/js/2.486d3524.js" as="script"><link rel="preload" href="/assets/js/11.dd3ee357.js" as="script"><link rel="prefetch" href="/assets/js/10.85ca922b.js"><link rel="prefetch" href="/assets/js/12.0053a2d5.js"><link rel="prefetch" href="/assets/js/13.5f1575e4.js"><link rel="prefetch" href="/assets/js/14.686b10ce.js"><link rel="prefetch" href="/assets/js/15.884be47b.js"><link rel="prefetch" href="/assets/js/16.299d7f3b.js"><link rel="prefetch" href="/assets/js/17.9ec4953e.js"><link rel="prefetch" href="/assets/js/18.5e70b600.js"><link rel="prefetch" href="/assets/js/19.abc47724.js"><link rel="prefetch" href="/assets/js/20.013813f8.js"><link rel="prefetch" href="/assets/js/21.e57eeb98.js"><link rel="prefetch" href="/assets/js/22.1fe6b826.js"><link rel="prefetch" href="/assets/js/3.10bbfb43.js"><link rel="prefetch" href="/assets/js/4.d2245081.js"><link rel="prefetch" href="/assets/js/5.8cad516c.js"><link rel="prefetch" href="/assets/js/6.ce2e1b0b.js"><link rel="prefetch" href="/assets/js/7.2acad4a3.js"><link rel="prefetch" href="/assets/js/8.f66a1a9f.js"><link rel="prefetch" href="/assets/js/9.0c854b8b.js">
    <link rel="stylesheet" href="/assets/css/0.styles.17d6210f.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/digger-logo-text.png" alt="" class="logo"> <!----></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <!----></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><!---->  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>Overview</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/" aria-current="page" class="sidebar-link">Introduction</a></li><li><a href="/overview/concepts.html" class="sidebar-link">Concepts</a></li><li><a href="/overview/how-it-works.html" class="sidebar-link">How It Works</a></li><li><a href="/overview/digger-vs-other.html" class="sidebar-link">Digger vs Other</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>CLI</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/cli/installation.html" class="sidebar-link">Install Digger CLI</a></li><li><a href="/cli/node-express.html" class="sidebar-link">Deploy Node app with CLI</a></li><li><a href="/cli/django.html" aria-current="page" class="active sidebar-link">Deploy Django app with CLI</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>Customize</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/customize/terraform.html" class="sidebar-link">Write your own Terraform</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/customize/terraform.html#terraform-overrides" class="sidebar-link">Terraform overrides</a></li><li class="sidebar-sub-header"><a href="/customize/terraform.html#custom-targets" class="sidebar-link">Custom Targets</a></li></ul></li><li><a href="/customize/cicd.html" class="sidebar-link">CI/CD Integrations</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/customize/cicd.html#github-actions" class="sidebar-link">Github Actions</a></li><li class="sidebar-sub-header"><a href="/customize/cicd.html#gitlab-ci" class="sidebar-link">GitLab CI</a></li></ul></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>Reference</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/reference-cli.html" class="sidebar-link">CLI reference</a></li><li><a href="/reference-yaml.html" class="sidebar-link">digger.yml reference</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>Miscellaneous</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/misc/aws-keys.html" class="sidebar-link">Creating AWS keys</a></li><li><a href="/misc/tagging-and-rollbacks.html" class="sidebar-link">Image tagging rollbacks</a></li><li><a href="/misc/env-vars-build.html" class="sidebar-link">Environment variables During Build</a></li><li><a href="/misc/secrets.html" class="sidebar-link">Secrets</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/misc/secrets.html#lambda-secrets" class="sidebar-link">Lambda Secrets</a></li></ul></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="deploy-django-app-with-cli"><a href="#deploy-django-app-with-cli" class="header-anchor">#</a> Deploy Django app with CLI</h1> <p>This guide shows how to get a Django app running in your AWS account with Digger
We are going to deploy this <a href="https://github.com/diggerhq/django-todolist" target="_blank" rel="noopener noreferrer">TODO list application<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>. This application needs a database for deployment. This specific application does not need celery and hence we don't need to create a queue or a separate service for background workers.</p> <p>You can see an example of this application deployed <a href="https://todo-example.dggr.app/" target="_blank" rel="noopener noreferrer">here<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p><img src="https://i.imgur.com/lWZFxjn.png" alt="TODO list application"></p> <h3 id="prerequisites"><a href="#prerequisites" class="header-anchor">#</a> Prerequisites</h3> <ul><li>Digger CLI installed - see <a href="/getting-started/installation.html">installation guide</a></li> <li>Dockerfile - see the excellent <a href="https://nodejs.org/en/docs/guides/nodejs-docker-webapp/" target="_blank" rel="noopener noreferrer">official guide<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> how to dockerize your Node.js app</li> <li><a href="https://docs.aws.amazon.com/cli/latest/userguide/install-cliv2.html" target="_blank" rel="noopener noreferrer">AWS CLI<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> installed - we need to this to push your docker image!</li> <li>You are logged into Digger - run <code>dg auth</code></li></ul> <h3 id="clone-the-respository"><a href="#clone-the-respository" class="header-anchor">#</a> Clone the respository</h3> <p>Clone our examples respository and remove the digger.yml file. We will re-initialize this file:</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token function">git</span> clone https://github.com/diggerhq/django-todolist
<span class="token builtin class-name">cd</span> django-todolist
<span class="token function">rm</span> digger.yml
</code></pre></div><h3 id="initialize-a-digger-project"><a href="#initialize-a-digger-project" class="header-anchor">#</a> Initialize a Digger project</h3> <p>Create a new project in Digger and generate a <code>digger.yml</code> configuration file</p> <div class="language-bash extra-class"><pre class="language-bash"><code>dg project init
</code></pre></div><p>We can update the digger.yml file services section to the following:</p> <div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token key atrule">services</span><span class="token punctuation">:</span>
  <span class="token key atrule">backend</span><span class="token punctuation">:</span>
    <span class="token key atrule">service_name</span><span class="token punctuation">:</span> backend
    <span class="token key atrule">path</span><span class="token punctuation">:</span> backend
    <span class="token key atrule">env_files</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    <span class="token key atrule">publicly_accessible</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
    <span class="token key atrule">service_type</span><span class="token punctuation">:</span> container
    <span class="token key atrule">container_port</span><span class="token punctuation">:</span> <span class="token number">8001</span>
    <span class="token key atrule">health_check</span><span class="token punctuation">:</span> /
    <span class="token key atrule">dockerfile</span><span class="token punctuation">:</span> backend/Dockerfile
    <span class="token key atrule">resources</span><span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
    <span class="token key atrule">dependencies</span><span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
</code></pre></div><p>Run the following command to sync these changes:</p> <div class="language-bash extra-class"><pre class="language-bash"><code>dg <span class="token function">sync</span>
</code></pre></div><div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>We could use dg service add to register the service, but in that case we need to update the container port value.</p></div> <h3 id="create-an-environment"><a href="#create-an-environment" class="header-anchor">#</a> Create an environment</h3> <p>This will be the &quot;destination&quot; of your app in your AWS account. Any project has at least one environment, but often more: Production / Dev / Staging, or one per customer, or one per geography. We are passing a <code>--target</code> parameter which points to our <a href="https://github.com/diggerhq/target-fargate/tree/todolist" target="_blank" rel="noopener noreferrer">terraform template<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>. This template will create the infrastructure needed to deploy this app to Amazon ECS Fargate. We have customised it to include an RDS instance. It will also wire the right database settings as environment variables üòâ</p> <div class="language-bash extra-class"><pre class="language-bash"><code>dg <span class="token function">env</span> create production --target diggerhq/target-fargate@todolist
dg <span class="token function">env</span> apply production
</code></pre></div><p>Digger will generate the infrastructure in your AWS account, so this step may take a few minutes.</p> <p>You should see the URL pointing to your service's load balancer. By default this will not contain the node app but a default image that is deployed. To deploy the node application we need to create a release.</p> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>To see which resources are aboout to be created you can run <code>dg env plan production</code>. In general it is recommended to run this command before each apply. You can see the apply happening live by passing the <code>--verbose</code> option to it.</p></div> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>You may see 'Service Temporarily Unavailable' once you load the loadbalancer url, its because the cluster is spinning up. In a few seconds it should show the default backend service.</p></div> <h3 id="deploy-your-app"><a href="#deploy-your-app" class="header-anchor">#</a> Deploy your app</h3> <div class="language-bash extra-class"><pre class="language-bash"><code>dg <span class="token function">env</span> build production
dg <span class="token function">env</span> push production
dg <span class="token function">env</span> deploy production
</code></pre></div><p>You should see the URL pointing to your service's load balancer. That's it! your todolist app deployedüôÇ</p> <h3 id="note-on-environment-variables"><a href="#note-on-environment-variables" class="header-anchor">#</a> Note on environment variables</h3> <p>Digger allows you to map important environment variables from your application directly into your application. In the above example, we automatically map the DATABASE_URL per environment into your application so that deployment just works out of the box. You can see a list of your environment variables in the <a href="https://app.digger.dev/" target="_blank" rel="noopener noreferrer">web UI<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>:</p> <p><img src="https://i.imgur.com/MhLYXT3.png" alt="Digger Environment Web UI"></p> <h3 id="destroy-the-environment"><a href="#destroy-the-environment" class="header-anchor">#</a> Destroy the environment</h3> <p>This will remove all infrastructure for the production environment from your AWS account if you don't need it anymore</p> <div class="language-bash extra-class"><pre class="language-bash"><code>dg <span class="token function">env</span> destroy production
</code></pre></div></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ‚Üê
      <a href="/cli/node-express.html" class="prev">
        Deploy Node app with CLI
      </a></span> <span class="next"><a href="/customize/terraform.html">
        Write your own Terraform
      </a>
      ‚Üí
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.a4767bdc.js" defer></script><script src="/assets/js/2.486d3524.js" defer></script><script src="/assets/js/11.dd3ee357.js" defer></script>
  </body>
</html>
