(window.webpackJsonp=window.webpackJsonp||[]).push([[11],{371:function(e,t,a){"use strict";a.r(t);var r=a(45),s=Object(r.a)({},(function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[a("h1",{attrs:{id:"deploy-node-app-with-cli"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#deploy-node-app-with-cli"}},[e._v("#")]),e._v(" Deploy Node app with CLI")]),e._v(" "),a("p",[e._v("This guide shows how to get a Node.js Express app running in your AWS account with Digger\nWe are going to deploy this "),a("a",{attrs:{href:"https://github.com/diggerhq/digger-examples/tree/master/node-service",target:"_blank",rel:"noopener noreferrer"}},[e._v("sample application"),a("OutboundLink")],1),e._v(" from the Digger Samples repository on GitHub.\nIt is a Node.js Express application created with the official "),a("a",{attrs:{href:"https://expressjs.com/en/starter/generator.html",target:"_blank",rel:"noopener noreferrer"}},[e._v("Express Generator"),a("OutboundLink")],1),e._v(", structured like this:")]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("â”œâ”€â”€ bin\nâ”‚   â””â”€â”€ www\nâ”œâ”€â”€ public\nâ”‚   â””â”€â”€ stylesheets\nâ”œâ”€â”€ routes\nâ”‚   â”œâ”€â”€ index.js\nâ”‚   â””â”€â”€ users.js\nâ”œâ”€â”€ views\nâ”‚   â”œâ”€â”€ error.jade\nâ”‚   â”œâ”€â”€ index.jade\nâ”‚   â””â”€â”€ layout.jade\nâ”œâ”€â”€ Dockerfile\nâ”œâ”€â”€ README.md\nâ”œâ”€â”€ app.js\nâ”œâ”€â”€ package-lock.json\nâ””â”€â”€ package.json\n")])])]),a("h3",{attrs:{id:"prerequisites"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#prerequisites"}},[e._v("#")]),e._v(" Prerequisites")]),e._v(" "),a("ul",[a("li",[e._v("Digger CLI installed - see "),a("RouterLink",{attrs:{to:"/getting-started/installation.html"}},[e._v("installation guide")])],1),e._v(" "),a("li",[e._v("Dockerfile - see the excellent "),a("a",{attrs:{href:"https://nodejs.org/en/docs/guides/nodejs-docker-webapp/",target:"_blank",rel:"noopener noreferrer"}},[e._v("official guide"),a("OutboundLink")],1),e._v(" how to dockerize your Node.js app")]),e._v(" "),a("li",[a("a",{attrs:{href:"https://docs.aws.amazon.com/cli/latest/userguide/install-cliv2.html",target:"_blank",rel:"noopener noreferrer"}},[e._v("AWS CLI"),a("OutboundLink")],1),e._v(" installed - we need to this to push your docker image!")]),e._v(" "),a("li",[e._v("You are logged into Digger - run "),a("code",[e._v("dg auth")])])]),e._v(" "),a("h3",{attrs:{id:"clone-the-respository"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#clone-the-respository"}},[e._v("#")]),e._v(" Clone the respository")]),e._v(" "),a("p",[e._v("Clone our examples respository:")]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("git clone https://github.com/diggerhq/digger-examples\ncd digger-examples\n")])])]),a("h3",{attrs:{id:"initialize-a-digger-project"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#initialize-a-digger-project"}},[e._v("#")]),e._v(" Initialize a Digger project")]),e._v(" "),a("p",[e._v("Create a new project in Digger and generate a "),a("code",[e._v("digger.yml")]),e._v(" configuration file")]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("dg project init\n")])])]),a("h3",{attrs:{id:"register-your-service"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#register-your-service"}},[e._v("#")]),e._v(" Register your service")]),e._v(" "),a("p",[e._v("Digger will analyse your app's code, update the "),a("code",[e._v("digger.yml")]),e._v(" file with appropriate settings, and synchronise it with the backend")]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("dg service add\ndg sync\n")])])]),a("p",[e._v("Alternatively you could just update this file manually, then run "),a("code",[e._v("dg sync")])]),e._v(" "),a("h3",{attrs:{id:"create-an-environment"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#create-an-environment"}},[e._v("#")]),e._v(" Create an environment")]),e._v(" "),a("p",[e._v('This will be the "destination" of your app in your AWS account. Any project has at least one environment, but often more: Production / Dev / Staging, or one per customer, or one per geography. We are passing a '),a("code",[e._v("--target")]),e._v(" parameter which points to our "),a("a",{attrs:{href:"https://github.com/diggerhq/target-fargate/tree/v1.0.4",target:"_blank",rel:"noopener noreferrer"}},[e._v("terraform template"),a("OutboundLink")],1),e._v(". This template will create the infrastructure needed to deploy this app to Amazon ECS Fargate.")]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("dg env create production --target diggerhq/target-fargate@v1.0.4\ndg env apply production\n")])])]),a("p",[e._v("Digger will generate the infrastructure in your AWS account, so this step may take a few minutes.")]),e._v(" "),a("p",[e._v("You should see the URL pointing to your service's load balancer. By default this will not contain the node app but a default image that is deployed. To deploy the node application we need to create a release.")]),e._v(" "),a("div",{staticClass:"custom-block tip"},[a("p",{staticClass:"custom-block-title"},[e._v("TIP")]),e._v(" "),a("p",[e._v("To see which resources are aboout to be created you can run "),a("code",[e._v("dg env plan production")]),e._v(". In general it is recommended to run this command before each apply. You can see the apply happening live by passing the "),a("code",[e._v("--verbose")]),e._v(" option to it.")])]),e._v(" "),a("div",{staticClass:"custom-block tip"},[a("p",{staticClass:"custom-block-title"},[e._v("TIP")]),e._v(" "),a("p",[e._v("You may see 'Service Temporarily Unavailable' once you load the loadbalancer url, its because the cluster is spinning up. In a few seconds it should show the default backend service.")])]),e._v(" "),a("h3",{attrs:{id:"deploy-your-app"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#deploy-your-app"}},[e._v("#")]),e._v(" Deploy your app")]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("dg env build production\ndg env push production\ndg env deploy production\n")])])]),a("p",[e._v("You should see the URL pointing to your service's load balancer. That's it! ðŸ™‚")]),e._v(" "),a("h3",{attrs:{id:"destroy-an-environment"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#destroy-an-environment"}},[e._v("#")]),e._v(" Destroy an environment")]),e._v(" "),a("p",[e._v("This will remove all infrastructure for the production environment from your AWS account if you don't need it anymore")]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("dg env destroy production\n")])])])])}),[],!1,null,null,null);t.default=s.exports}}]);